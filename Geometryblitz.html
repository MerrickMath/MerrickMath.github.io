<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geometry Blitz</title>
  <style>
    :root {
      --bg: #ffffff;
      --card: #f9fafb;
      --muted: #374151;
      --text: #111827;
      --ring: 0 0 0 3px rgba(59,130,246,.35);
      --green: #4ade80;
      --red: #f87171;
      --orange: #fb923c;
      --black: #111827;
      --pink: #f472b6;
      --yellow: #facc15;
    }

    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial; background: var(--bg); color: var(--text); }

    .page { max-width: 980px; margin: 24px auto 56px; padding: 0 16px; }

    .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px; }
    h1 { margin:0; font-size: clamp(20px,3vw,28px); }
    .controls { display:flex; gap:10px; }
    button { appearance:none; border:0; padding:10px 14px; border-radius:12px; background:#e5e7eb; font-weight:600; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.12); }
    button:hover { filter:brightness(1.05); }

    .layout { display:grid; grid-template-columns: 1fr; gap:18px; align-items:start; }

    .legend { background:#f3f4f6; padding:14px; border-radius:16px; box-shadow:0 6px 14px rgba(0,0,0,.08); }
    .legend h3 { margin:0 0 8px 0; font-size:16px; color:var(--muted); text-align:center; }
    .legend-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .pill { display:flex; align-items:center; gap:6px; justify-content:center; padding:6px 8px; border-radius:12px; background:#e5e7eb; font-size:13px; }
    .dot { width:12px; height:12px; border-radius:50%; border:2px solid #111827; }

    .card { background:var(--card); padding:16px; border-radius:16px; box-shadow:0 6px 14px rgba(0,0,0,.12); }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(160px, 1fr)); gap:18px; }
    .slot { background:#f3f4f6; border-radius:18px; height:210px; display:grid; place-items:center; position:relative; }
    .slot.correct { outline: var(--ring); }
    svg { width:90%; height:90%; }

    .status { margin-top:10px; font-size:14px; color:var(--muted); min-height:22px; text-align:center; }

    .label { position:absolute; bottom:6px; left:50%; transform:translateX(-50%); font-size:12px; padding:2px 8px; border-radius:999px; background:#e5e7eb; color:var(--text); border:1px solid rgba(0,0,0,.08); z-index:2; pointer-events:none; }
    .hidden { display:none; }

    .defs { margin: 16px auto; max-width: 980px; }
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <h1>Geometry Blitz</h1>
      <div style='font-size:14px; color:#6b7280; margin-top:2px;'>Math with Mr. Merrick</div>
      <div class="controls">
        <button id="btnShow">Show solution</button>
        <button id="btnNew">New card</button>
      </div>
    </div>

    <!-- Legend TOP -->
    <aside class="legend" aria-label="Home colors legend">
      <h3>Home colors</h3>
      <div class="legend-grid" id="legendRow"></div>
    </aside>

    <!-- Card BELOW -->
    <section class="card">
      <div class="grid" id="grid" role="group" aria-label="Card with shapes"></div>
      <div id="status" class="status" aria-live="polite"></div>
    </section>
  </div>

  <script>
    const SHAPES = ["Triangle", "Kite", "Trapezoid", "Parallelogram", "Pentagon", "Hexagon"];
    const HOME = {
      Triangle:   css("--green"),
      Kite:       css("--red"),
      Trapezoid:  css("--orange"),
      Parallelogram: css("--black"),
      Pentagon:   css("--pink"),
      Hexagon:    css("--yellow")
    };
    const COLORS = Object.values(HOME);

    const VARIANTS = {
      Triangle: [
        [[90,15],[15,165],[165,165]],
        [[20,150],[160,160],[100,30]],
        [[20,160],[160,160],[20,40]],
        [[30,150],[150,150],[90,40]],
        [[50,160],[140,160],[95,30]]
      ],
      Kite: [
        [[90,20],[150,90],[90,160],[40,90]],
        [[90,24],[145,94],[90,156],[35,94]],
        [[90,28],[140,96],[90,152],[40,96]],
        [[90,22],[148,92],[90,158],[42,92]],
        [[90,26],[142,98],[90,154],[38,98]]
      ],
      Trapezoid: [
        [[35,35],[145,35],[170,165],[10,165]],
        [[50,40],[130,40],[160,160],[20,160]],
        [[40,40],[140,40],[170,160],[0,160]],
        [[45,45],[135,45],[150,160],[15,160]],
        [[55,35],[125,35],[160,165],[20,165]]
      ],
      Parallelogram: [
        [[30,50],[160,50],[130,160],[0,160]],
        [[40,40],[170,40],[140,150],[10,150]],
        [[30,60],[150,60],[120,160],[0,160]],
        [[50,45],[160,45],[135,155],[25,155]],
        [[20,55],[165,55],[135,165],[-10,165]]
      ],
      Pentagon: [
        regPoly(90,95,75,5),
        [[90,20],[150,80],[120,160],[60,160],[30,80]],
        [[90,25],[145,85],[115,155],[65,155],[35,85]],
        [[90,30],[140,90],[120,150],[60,150],[40,90]],
        [[90,20],[155,85],[125,160],[55,160],[25,85]]
      ],
      Hexagon: [
        regPoly(90,95,70,6),
        regPoly(90,95,65,6),
        regPoly(90,95,60,6),
        [[50,60],[130,60],[160,95],[130,130],[50,130],[20,95]],
        [[55,65],[125,65],[150,95],[125,125],[55,125],[30,95]]
      ]
    };

    const gridEl = document.getElementById('grid');
    const statusEl = document.getElementById('status');
    const btnNew = document.getElementById('btnNew');
    const btnShow = document.getElementById('btnShow');
    const legendRow = document.getElementById('legendRow');

    let state = { items: [], solution: null };

    function css(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
    function sample(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function shuffle(arr){ return arr.slice().sort(()=>Math.random()-.5); }

    function makeLegend(){
      legendRow.innerHTML = '';
      SHAPES.forEach(s => {
        const pill = document.createElement('div'); pill.className = 'pill';
        const dot = document.createElement('span'); dot.className = 'dot'; dot.style.background = HOME[s];
        const label = document.createElement('span'); label.textContent = s;
        pill.append(dot, label);
        legendRow.appendChild(pill);
      });
    }

    function svgBox(){ const s = document.createElementNS('http://www.w3.org/2000/svg','svg'); s.setAttribute('viewBox','0 0 180 180'); return s; }
    function poly(points, fill){
      const p = document.createElementNS('http://www.w3.org/2000/svg','polygon');
      p.setAttribute('points', points.map(pt=>pt.join(',')).join(' '));
      p.setAttribute('fill', fill);
      p.setAttribute('stroke', 'black');
      p.setAttribute('stroke-width', '3');
      p.setAttribute('vector-effect', 'non-scaling-stroke');
      return p;
    }
    function regPoly(cx,cy,r,n){
      const pts=[]; const start=-Math.PI/2;
      for(let i=0;i<n;i++){ const a=start+i*2*Math.PI/n; pts.push([cx+r*Math.cos(a), cy+r*Math.sin(a)]); }
      return pts;
    }
    function drawShape(shape,color){
      const svg = svgBox();
      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      let angleSet = [0,30,60,90,120,150,180,210,240,270,300,330];
      if(shape==='Kite') angleSet = [0,90,180,270];
      if(shape==='Parallelogram') angleSet = [20,200,340,160];
      const angle = angleSet[Math.floor(Math.random()*angleSet.length)];
      g.setAttribute('transform', `rotate(${angle} 90 90)`);
      const pts = sample(VARIANTS[shape]);
      g.appendChild(poly(pts, color));
      svg.appendChild(g);
      return svg;
    }

    function renderCard(shapes, colors){
      gridEl.innerHTML = '';
      state.items = [];
      shapes.forEach((shape,i)=>{
        const slot = document.createElement('div'); slot.className = 'slot';
        const svg = drawShape(shape, colors[i]);
        slot.appendChild(svg);
        const label = document.createElement('div'); label.className = 'label hidden'; label.textContent = shape; slot.appendChild(label);
        gridEl.appendChild(slot);
        state.items.push({shape, color: colors[i], slotEl: slot, svgEl: svg, labelEl: label});
      });
    }

    function computeSolution(){
      const homeIdxs = state.items.map((it,idx)=>it.color===HOME[it.shape]?idx:-1).filter(i=>i!==-1);
      if(homeIdxs.length === 1){
        const idx = homeIdxs[0];
        return { type:'home', target: state.items[idx].shape, index: idx, explain: `${state.items[idx].shape} appears in its home color.` };
      }
      const shownShapes = state.items.map(it=>it.shape);
      const shownColors = state.items.map(it=>it.color);
      const cands = SHAPES.filter(s => !shownShapes.includes(s) && !shownColors.includes(HOME[s]));
      if(cands.length === 1){
        return { type:'absent', target: cands[0], index: -1, explain: `${cands[0]} is the only shape whose shape and home color are both missing.` };
      }
      return { type:'none', target:null, index:-1, explain:'No solution on this card.' };
    }

    function newCard(){
      statusEl.textContent = '';
      const r = Math.random();
      if(r < 0.30){
        const target = sample(SHAPES);
        const others = shuffle(SHAPES.filter(s=>s!==target)).slice(0,3);
        const chosen = [target, ...others];
        const colors = [];
        colors.push(HOME[target]);
        const used = new Set([HOME[target]]);
        for(const s of others){
          const pool = COLORS.filter(c => c !== HOME[s] && !used.has(c));
          const pick = sample(pool);
          colors.push(pick); used.add(pick);
        }
        renderCard(chosen, colors);
      } else if(r < 0.85){
        const T = sample(SHAPES);
        let U = sample(SHAPES); while(U===T) U = sample(SHAPES);
        const shown = SHAPES.filter(s=>s!==T && s!==U);
        const available = COLORS.filter(c=>c!==HOME[T]);
        const colors = [HOME[U]];
        const rest = available.filter(c=>c!==HOME[U]);
        const shuffled = shuffle(rest);
        while(colors.length<4) colors.push(shuffled.shift());
        let assign = shuffle(colors), tries=0;
        while(shown.some((s,i)=>assign[i]===HOME[s]) && tries<200){ assign = shuffle(colors); tries++; }
        renderCard(shown, assign);
      } else {
        const chosen = shuffle(SHAPES).slice(0,4);
        const colors = shuffle(COLORS).slice(0,4);
        renderCard(chosen, colors);
      }
      state.solution = computeSolution();
    }

    function showSolution(){
      if(!state.solution) return;
      state.items.forEach(it=>{
        it.slotEl.classList.remove('correct');
        if(it.labelEl) it.labelEl.classList.remove('hidden');
      });
      if(state.solution.type==='home'){
        const t = state.items[state.solution.index];
        if(t) t.slotEl.classList.add('correct');
      }
      statusEl.innerHTML = (state.solution.type==='none')
        ? 'No solution on this card.'
        : `Answer: <strong>${state.solution.target}</strong> — ${state.solution.explain}`;
    }

    btnNew.addEventListener('click', newCard);
    btnShow.addEventListener('click', showSolution);
    window.addEventListener('keydown', e=>{
      const k = e.key.toLowerCase();
      if(k==='n') newCard();
      if(k==='s') showSolution();
    });

    makeLegend();
    newCard();
  </script>
  <section class="card defs" aria-label="Game instructions">
    <h2>How to play Geometry Blitz</h2>
    <ol>
      <li>Each card shows four colored shapes.</li>
      <li>Use the legend on the left to see each shape’s “home color.”</li>
      <li>If exactly one shape appears in its home color, that shape is the answer.</li>
      <li>If no shape is in its home color, find the one shape whose shape and home color are both absent from the card — that shape is the answer.</li>
      <li>If neither rule applies, then the card has no solution.</li>
      <li>Press <em>Show solution</em> to reveal the answer and labels; press <em>New card</em> to play again.</li>
      <li>You can also press keyboard keys: <strong>N</strong> for new card, <strong>S</strong> to show solution.</li>
    </ol>
  </section>

  <section class="card defs" aria-label="Geometry definitions">
    <h2>Geometry definitions</h2>

    <h3>Polygons used in this game</h3>
    <ul>
      <li><strong>Triangle</strong>: a polygon with 3 sides and 3 angles.</li>
      <li><strong>Pentagon</strong>: a polygon with 5 sides.</li>
      <li><strong>Hexagon</strong>: a polygon with 6 sides.</li>
    </ul>

    <h3>Quadrilaterals (all 4‑sided polygons)</h3>
    <p><em>Quadrilateral</em> means any polygon with four sides. The common families below may overlap (for example, every square is also a rectangle, a rhombus, and a parallelogram). We use the <em>exclusive</em> definition of trapezoid: exactly one pair of parallel sides.</p>
    <ul>
      <li><strong>Kite</strong>: a quadrilateral with two pairs of <em>adjacent</em> equal sides. In this game our kites use two different pair-lengths, so they are not rhombi.</li>
      <li><strong>Trapezoid</strong>: a quadrilateral with <em>exactly one</em> pair of parallel sides (the bases).</li>
      <li><strong>Parallelogram</strong>: a quadrilateral with <em>two</em> pairs of parallel sides. Opposite sides are equal in length and opposite angles are equal.</li>
      <li><strong>Rectangle</strong>: a parallelogram with four right angles.</li>
      <li><strong>Rhombus</strong>: a parallelogram with all four sides equal in length. (Note: we purposely avoid rhombi in this game so a kite cannot also be a parallelogram.)</li>
      <li><strong>Square</strong>: a rectangle and a rhombus (four equal sides and four right angles).</li>
    </ul>

    <p><strong>Game question:</strong> This game never generates a rhombus—kites have two pairs of adjacent equal sides of different lengths, and parallelograms have unequal adjacent side lengths. <em>Why is this necessary?</em></p>
  </section>

  <footer class="card defs" style="text-align:center; font-size:13px; color:#6b7280; margin:16px auto; max-width:980px;">
    Math with Mr. Merrick
  </footer>
</body>
</html>
