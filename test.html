<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Camel Up – Monte Carlo Simulator (with Crazy Camels)</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --muted:#5b6b88; --text:#0d1b2a; --accent:#2563eb; --border:#d8e0ef; --chip:#eef2f9;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:1100px; margin:32px auto; padding:0 16px}
    h1{margin:0 0 8px; font-size:clamp(22px,3.8vw,36px)}
    p.subtitle{margin:0 0 20px; color:var(--muted)}
    .grid{display:grid; gap:16px}
    @media (min-width:900px){.grid{grid-template-columns: 1.2fr 1fr}}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 6px 18px rgba(13,27,42,.05)}
    .card h2{margin:0 0 12px; font-size:18px; color:var(--accent)}
    .row{display:grid; grid-template-columns: 160px 1fr 1fr; gap:8px; align-items:center; padding:6px 8px; border-radius:12px}
    .row:nth-child(odd){background:var(--chip)}
    .badge{display:inline-flex; align-items:center; gap:8px; font-weight:700}
    .dot{width:16px; height:16px; border-radius:999px; display:inline-block; border:1px solid rgba(0,0,0,.15)}
    input[type="number"], select{width:100%; background:#fff; border:1px solid var(--border); color:var(--text); border-radius:10px; padding:8px 10px; font-size:14px}
    input[type="number"]:focus, select:focus{outline:2px solid #93c5fd; border-color:#93c5fd}
    .controls{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px}
    .controls > *{flex:1 0 auto}
    button{cursor:pointer; background:linear-gradient(180deg,#93c5fd,#60a5fa); color:#05152b; font-weight:800; border:none; padding:12px 16px; border-radius:12px; box-shadow:0 6px 18px rgba(37,99,235,.20)}
    button.secondary{background:#fff; border:1px solid var(--border); color:#1f2937}
    .note{font-size:12px; color:var(--muted)}
    table{width:100%; border-collapse:collapse}
    th,td{padding:8px 10px; text-align:center; border-bottom:1px solid var(--border)}
    th{color:#334155; font-weight:700}
    .pill{display:inline-block; padding:.25rem .6rem; border-radius:999px; border:1px solid var(--border); min-width:3.2ch; background:#fff}
    .footer{margin-top:12px; font-size:12px; color:#64748b}
    .track{display:grid; grid-template-columns: repeat(var(--len), 26px); gap:4px; align-items:end}
    .space{height:84px; background:#ffffff; border:1px dashed var(--border); border-radius:8px; display:flex; flex-direction:column-reverse; align-items:center; justify-content:flex-start; padding:4px}
    .camel{width:18px; height:12px; border-radius:3px; border:1px solid rgba(0,0,0,.15); margin:3px 0; box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .camel.crazy{outline:2px dashed #0f172a; outline-offset:1px}
    .legend{display:flex; gap:10px; align-items:center; flex-wrap:wrap; font-size:12px}
    .legend .camel{width:14px; height:10px}
    .mono{font-variant-numeric: tabular-nums}
    .sectionLabel{margin-top:8px; margin-bottom:6px; font-weight:700; color:#334155}
    .roundlog{margin-top:12px; font-size:13px; color:#0f172a; max-height:260px; overflow:auto}
    .roundlog table{font-size:12px; border:1px solid var(--border)}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Camel Up – placement simulator</h1>
    <p class="subtitle">Now includes <b>crazy camels</b> (black & white) moving backwards from the finish. Only the five racers compete for placements.</p>

    <div class="grid">
      <section class="card" id="setup">
        <h2>Setup</h2>
        <div class="sectionLabel">Racing camels (start from the beginning; move forward):</div>
        <div id="rows-racers"></div>
        <div class="sectionLabel">Crazy camels (start near the finish; move backward):</div>
        <div id="rows-crazy"></div>
        <div class="controls">
          <label class="pill">Track length
            <input type="number" id="trackLen" min="6" max="40" step="1" value="16" />
          </label>
          <label class="pill">Simulations
            <input type="number" id="sims" min="1" max="100000" step="1" value="100" />
          </label>
          <button id="runBtn">Run simulation</button>
          <button id="randomizeBtn" class="secondary">Randomize starts</button>
        </div>
        <p class="note">For stacks at the same space, <b>Stack order</b> is bottom→top (1 = bottom). Crazy camels carry any camels stacked on them <i>backwards</i> and are placed at the <b>bottom</b> of their destination stack.</p>

        <div class="legend" style="margin-top:10px">
          <div class="camel" style="background:#3b82f6"></div> Blue
          <div class="camel" style="background:#22c55e"></div> Green
          <div class="camel" style="background:#eab308"></div> Yellow
          <div class="camel" style="background:#f97316"></div> Orange
          <div class="camel" style="background:#a855f7"></div> Purple
          <div class="camel crazy" style="background:#111827"></div> Black (crazy)
          <div class="camel crazy" style="background:#f8fafc; border-color:#cbd5e1"></div> White (crazy)
        </div>
      </section>

      <section class="card">
        <h2>Board (live view of one run)</h2>
        <div id="board" class="track" style="--len:16; overflow:auto"></div>
        <div class="footer">Finish is just beyond the last space. Furthest space wins ties; within a stack, the <b>top</b> camel is ahead.</div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h2>Results</h2>
      <div id="results">Run the simulation to see placement distributions for the five racers.</div>
      <div id="rounds" class="roundlog"></div>
    </section>

    <div class="footer">Single-file. Drop this <span class="mono">index.html</span> onto GitHub Pages.</div>
  </div>

  <script>
    // === Config ===
    const RACERS = [
      { id: 'blue',   name: 'Blue',   color: '#3b82f6' },
      { id: 'green',  name: 'Green',  color: '#22c55e' },
      { id: 'yellow', name: 'Yellow', color: '#eab308' },
      { id: 'orange', name: 'Orange', color: '#f97316' },
      { id: 'purple', name: 'Purple', color: '#a855f7' },
    ];
    const CRAZY = [
      { id: 'black', name: 'Black (crazy)', color:'#111827', crazy:true },
      { id: 'white', name: 'White (crazy)', color:'#f8fafc', border:'#cbd5e1', crazy:true },
    ];
    const CAMELS = [...RACERS, ...CRAZY];

    // === Utilities ===
    const el = sel => document.querySelector(sel);
    const make = (tag, props={}) => Object.assign(document.createElement(tag), props);
    const clamp=(x,a,b)=> Math.max(a, Math.min(b,x));
    const ordinal = n => { const s=["th","st","nd","rd"], v=n%100; return n+(s[(v-20)%10]||s[v]||s[0]); };
    const shuffle = (arr)=>{ const a = arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; };
    const isCrazyId = cid => CRAZY.some(c=>c.id===cid);

    // === Setup rows ===
    const rowsR = el('#rows-racers');
    const rowsC = el('#rows-crazy');
    function buildRows(){
      rowsR.innerHTML = '';
      rowsC.innerHTML = '';
      const headerR = make('div', { className: 'row', innerHTML: '<div class="badge" style="opacity:.7">Camel</div><div>Start space</div><div>Stack order</div>' });
      rowsR.appendChild(headerR);
      RACERS.forEach((c, i)=>{
        const row = make('div', { className: 'row' });
        const badge = make('div', { className: 'badge' });
        const dot = make('span', { className: 'dot' });
        dot.style.background = c.color;
        badge.append(dot, document.createTextNode(' '+c.name));
        const pos = make('input', { type:'number', min:0, max:39, step:1, value:0 }); pos.id = `pos-${c.id}`;
        const order = make('input', { type:'number', min:1, max:10, step:1, value:i+1 }); order.id = `ord-${c.id}`;
        row.append(badge, pos, order);
        rowsR.appendChild(row);
      });
      const headerC = make('div', { className: 'row', innerHTML: '<div class="badge" style="opacity:.7">Camel</div><div>Spaces from finish</div><div>Stack order</div>' });
      rowsC.appendChild(headerC);
      CRAZY.forEach((c, i)=>{
        const row = make('div', { className: 'row' });
        const badge = make('div', { className: 'badge' });
        const dot = make('span', { className: 'dot' });
        dot.style.background = c.color; if(c.border) dot.style.borderColor = c.border;
        badge.append(dot, document.createTextNode(' '+c.name));
        const pos = make('input', { type:'number', min:0, max:39, step:1, value:0 }); pos.id = `pos-${c.id}`; // distance from finish
        const order = make('input', { type:'number', min:1, max:10, step:1, value:i+1 }); order.id = `ord-${c.id}`;
        row.append(badge, pos, order);
        rowsC.appendChild(row);
      });
    }
    buildRows();

    // Randomize
    el('#randomizeBtn').addEventListener('click', ()=>{
      const spots = shuffle([0,1,2,3,4]);
      RACERS.forEach((c,i)=>{ el(`#pos-${c.id}`).value = spots[i]; el(`#ord-${c.id}`).value = i+1; });
      CRAZY.forEach((c,i)=>{ el(`#pos-${c.id}`).value = i; el(`#ord-${c.id}`).value = i+1; });
      drawBoard(buildInitialBoard());
    });

    // === Board building ===
    function buildInitialBoard(){
      const trackLen = clamp(parseInt(el('#trackLen').value||16,10), 6, 40);
      const groups = new Map(); // space -> array of {camel,ord,crazy}
      // racers
      RACERS.forEach(c=>{
        const space = clamp(parseInt(el(`#pos-${c.id}`).value||0,10), 0, 1000);
        const ord = parseInt(el(`#ord-${c.id}`).value||0,10) || 0;
        if(!groups.has(space)) groups.set(space, []);
        groups.get(space).push({ camel:c.id, ord, crazy:false });
      });
      // crazy (distance from finish)
      CRAZY.forEach(c=>{
        const fromFinish = clamp(parseInt(el(`#pos-${c.id}`).value||0,10), 0, 1000);
        const space = Math.max(0, trackLen - 1 - fromFinish);
        const ord = parseInt(el(`#ord-${c.id}`).value||0,10) || 0;
        if(!groups.has(space)) groups.set(space, []);
        groups.get(space).push({ camel:c.id, ord, crazy:true });
      });
      // sort & flatten
      const board = new Map();
      for(const [space, arr] of groups.entries()){
        arr.sort((a,b)=> (a.ord??0)-(b.ord??0) || a.camel.localeCompare(b.camel));
        board.set(space, arr.map(x=>x.camel)); // bottom -> top
      }
      return board;
    }

    // Locate camel on board
    function locate(board, camel){
      for(const [s, stack] of board.entries()){
        const idx = stack.indexOf(camel);
        if(idx!==-1) return { space:s, index:idx };
      }
      return { space:-1, index:-1 };
    }

    // Positions map {cid: space}
    function positionsFromBoard(board){
      const pos = new Map();
      for(const [s, stack] of board.entries()){
        for(let i=0;i<stack.length;i++) pos.set(stack[i], s);
      }
      return pos;
    }

    // === Single-race simulation (returns round log) ===
    function simulateRace(startBoard, trackLen){
      const board = new Map();
      for(const [k,v] of startBoard.entries()) board.set(k, v.slice());
      let finished = false;
      const roundLog = [];
      let round = 1;

      while(!finished){
        let bag = CAMELS.map(c=>c.id); // dice left this leg
        const legMoves = [];
        while(bag.length && !finished){
          const pickIdx = Math.floor(Math.random()*bag.length);
          const camel = bag.splice(pickIdx,1)[0];
          const roll = 1 + Math.floor(Math.random()*3); // 1..3

          const {space, index} = locate(board, camel);
          if(space===-1) throw new Error('Camel not found on board');
          const movers = board.get(space).slice(index); // camel + above
          const stayers = board.get(space).slice(0, index);
          if(stayers.length) board.set(space, stayers); else board.delete(space);

          if(isCrazyId(camel)){
            const dest = Math.max(0, space - roll);
            const destStack = board.get(dest) || [];
            // crazy camels (and riders) go to BOTTOM
            board.set(dest, movers.concat(destStack));
          } else {
            const dest = space + roll;
            const destStack = board.get(dest) || [];
            // racers go to TOP
            destStack.push(...movers);
            board.set(dest, destStack);
            if(dest >= trackLen) finished = true; // race ends immediately
          }

          legMoves.push({ camel, roll });
        }
        roundLog.push({ round, moves: legMoves, positions: positionsFromBoard(board) });
        round++;
      }

      // Final placements among racers only
      const racers = new Set(RACERS.map(c=>c.id));
      const maxSpace = Math.max(...board.keys());
      const order = [];
      for(let s = maxSpace; s >= -100; s--){
        if(!board.has(s)) continue;
        const stack = board.get(s);
        for(let i = stack.length-1; i>=0; i--){
          const cid = stack[i];
          if(racers.has(cid)) order.push(cid);
        }
      }
      const placement = new Map();
      order.forEach((cid, idx)=> placement.set(cid, idx+1));
      return { placement, finalBoard: board, roundLog };
    }

    // === Monte Carlo wrapper ===
    function runSimulations(n, startBoard, trackLen){
      const places = RACERS.length;
      const counts = new Map();
      RACERS.forEach(c=> counts.set(c.id, Array(places).fill(0)));
      let sampleBoard = null;
      let sampleRounds = null;
      for(let i=0;i<n;i++){
        const { placement, finalBoard, roundLog } = simulateRace(startBoard, trackLen);
        RACERS.forEach(c=>{
          const p = placement.get(c.id) || places; // safety
          counts.get(c.id)[p-1] += 1;
        });
        if(i===0){ sampleBoard = finalBoard; sampleRounds = roundLog; }
      }
      return { counts, sampleBoard, sampleRounds };
    }

    // === Rendering ===
    function drawBoard(board){
      const trackLen = parseInt(el('#trackLen').value,10) || 16;
      const boardEl = el('#board');
      boardEl.style.setProperty('--len', trackLen.toString());
      boardEl.innerHTML = '';
      for(let s=0; s<trackLen; s++){
        const cell = make('div', { className: 'space' });
        const stack = board.get(s) || [];
        stack.forEach(cid=>{
          const cfg = CAMELS.find(x=>x.id===cid);
          const cam = make('div', { className:'camel'+(cfg.crazy?' crazy':''), title: cfg.name });
          cam.style.background = cfg.color; if(cfg.border) cam.style.borderColor = cfg.border;
          cell.appendChild(cam);
        });
        boardEl.appendChild(cell);
      }
    }

    function renderResults(counts, sims){
      const container = el('#results');
      const places = RACERS.length;
      let html = '<div style="overflow:auto"><table><thead><tr><th>Camel</th>';
      for(let p=1;p<=places;p++) html += `<th>${ordinal(p)}</th>`;
      html += '</tr></thead><tbody>';
      RACERS.forEach(c=>{
        html += `<tr><td style="text-align:left" class="nowrap"><span class="camel" style="background:${c.color}; vertical-align:middle; display:inline-block"></span> ${c.name}</td>`;
        const arr = counts.get(c.id);
        for(let p=0;p<places;p++){
          const k = arr[p];
          const pct = (k/sims*100).toFixed(1);
          html += `<td><div class="mono">${k}</div><div class="note">${pct}%</div></td>`;
        }
        html += '</tr>';
      });
      html += '</tbody></table></div>';
      container.innerHTML = html;
    }

    function shortName(cid){
      switch(cid){
        case 'blue': return 'Blue';
        case 'green': return 'Green';
        case 'yellow': return 'Yellow';
        case 'orange': return 'Orange';
        case 'purple': return 'Purple';
        case 'black': return 'Black';
        case 'white': return 'White';
        default: return cid;
      }
    }

    function renderRoundLog(rounds, trackLen){
      const container = el('#rounds');
      if(!rounds || !rounds.length){ container.innerHTML = ''; return; }
      let html = '<h3 style="margin:12px 0 6px">Round-by-round log</h3>';
      html += '<div style="overflow:auto"><table><thead><tr><th>Round</th><th style="min-width:260px">Dice order</th>';
      [...RACERS, ...CRAZY].forEach(c=>{ html += `<th class="nowrap">${c.name}</th>`; });
      html += '</tr></thead><tbody>';
      rounds.forEach(leg=>{
        const moveStr = leg.moves.map(m=> `${shortName(m.camel)}:${m.roll}${isCrazyId(m.camel)?'←':''}`).join(', ');
        html += `<tr><td class="mono">${leg.round}</td><td style="text-align:left">${moveStr || '—'}</td>`;
        [...RACERS, ...CRAZY].forEach(c=>{
          const pos = leg.positions.get(c.id);
          let val = (pos!=null? pos : '—');
          if(typeof val==='number' && val>=trackLen) val = `${val} (finish)`;
          html += `<td class="mono">${val}</td>`;
        });
        html += '</tr>';
      });
      html += '</tbody></table></div>';
      html += '<div class="note" style="margin-top:6px">Crazy camel moves are marked with a ← in the dice order. Numbers are track spaces (0-indexed); values ≥ track length indicate the winners have crossed the finish.</div>';
      container.innerHTML = html;
    }

    // === Live preview ===
    function updatePreview(){ drawBoard(buildInitialBoard()); }
    el('#setup').addEventListener('input', updatePreview);
    el('#trackLen').addEventListener('input', updatePreview);
    updatePreview();

    // === Run button ===
    el('#runBtn').addEventListener('click', ()=>{
      const sims = clamp(parseInt(el('#sims').value||100,10), 1, 100000);
      const trackLen = clamp(parseInt(el('#trackLen').value||16,10), 6, 40);
      const startBoard = buildInitialBoard();
      const { counts, sampleBoard, sampleRounds } = runSimulations(sims, startBoard, trackLen);
      renderResults(counts, sims);
      drawBoard(sampleBoard);
      renderRoundLog(sampleRounds, trackLen);
      el('#board').style.setProperty('--len', trackLen.toString());
    });
  </script>
</body>
</html>
