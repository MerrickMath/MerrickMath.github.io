<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prime‚ÄëFactor Sprint</title>
  <meta name="description" content="Race the clock to speak the prime/composite sequence. Bright, clean, and classroom-ready."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&family=STIX+Two+Text:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #f6fbff;
      --ink: #0f172a;
      --muted: #475569;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-2: #f97316;
      --ok: #10b981;
      --warn: #f59e0b;
      --bad: #ef4444;
      --shadow: 0 10px 25px rgba(2, 6, 23, 0.12);
      --r: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:
        radial-gradient(1200px 600px at 10% -10%, #e0f2fe 0%, transparent 60%),
        radial-gradient(1200px 600px at 110% 10%, #ffe4e6 0%, transparent 60%),
        var(--bg);
      color:var(--ink); font-family: "Outfit", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "STIX Two Text", serif;
      display:flex; align-items:center; justify-content:center;
    }
    .app{ width:min(1080px, 96vw); }
    header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px; }
    .logo{ display:flex; align-items:center; gap:12px; }
    .logo .mark{ font-size:28px; }
    .logo h1{ margin:0; font-weight:800; letter-spacing:.2px; font-size:clamp(22px,3.2vw,30px); }

    .card{ background:var(--card); border-radius:var(--r); box-shadow:var(--shadow); padding:clamp(16px,2.6vw,24px); }
    .controls{ display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:10px; }
    @media (max-width:900px){ .controls{ grid-template-columns:1fr; } }
    label{ font-weight:600; color:var(--muted); }
    select, button, input[type="text"]{ border:1px solid rgba(15,23,42,.1); border-radius:14px; padding:10px 12px; font-size:16px; background:#fff; }
    button{ cursor:pointer; font-weight:800; letter-spacing:.2px; }
    .primary{ background:var(--accent); color:#fff; border:none; }
    .muted{ background:#f8fafc; color:var(--muted); }
    .danger{ background:var(--bad); color:#fff; border:none; }

    .columns{ display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; }
    @media (max-width:900px){ .columns{ grid-template-columns:1fr; } }

    .timer{ height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden; margin-bottom:12px; }
    .timer > .bar{ height:100%; width:100%; background:linear-gradient(90deg, var(--ok), var(--warn), var(--bad)); transition: width .15s linear; }
    .timer.unlimited{ background:transparent; }

    .question{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .n{ font-family:"STIX Two Text", serif; font-weight:800; font-size: clamp(34px, 7vw, 58px); letter-spacing:.4px; }

    .jump{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:12px; background:#f1f5f9; border:1px dashed rgba(2,6,23,.12); color:var(--muted); font-weight:700; }
    .jump .badge{ font-size:22px; line-height:1; padding:6px 10px; border-radius:12px; background:#fff; border:1px solid rgba(2,6,23,.08); box-shadow:0 2px 6px rgba(2,6,23,.08); }

    .answer{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:10px; }
    input[type="text"]{ font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:clamp(18px,3vw,22px); min-width:220px; padding:12px 14px; }

    .feedback{ min-height:28px; font-weight:700; }
    .ok{ color:var(--ok) }
    .bad{ color:var(--bad) }

    .history h3{ margin:12px 0 6px; color:var(--muted); font-size:14px; }
    .items{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{ background:#f8fafc; border:1px solid rgba(2,6,23,.08); border-radius:999px; padding:8px 12px; font-family:"JetBrains Mono"; font-size:14px; }

    .status{ display:grid; grid-template-columns: repeat(4,1fr); gap:10px; }
    .tile{ background:#f8fafc; border:1px solid rgba(2,6,23,.06); border-radius:16px; padding:12px 14px; text-align:center; }
    .tile .k{ font-weight:800; font-size:22px; }
    .tile .v{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.3px; }

    .shake{ animation:shake .25s linear 2; }
    @keyframes shake{ 0%{transform:translateX(0)}25%{transform:translateX(4px)}50%{transform:translateX(-4px)}75%{transform:translateX(3px)}100%{transform:translateX(0)} }

    .hidden{ display:none !important; }
    /* Center the question row and hide the small jump widget */
    .question{ display:flex; align-items:center; justify-content:center; text-align:center; gap:12px; }
    
    /* Hide the current n so students must remember it */
    .n{ display:none; }
    
    /* Big central ‚ÄúNext jump‚Äù text */
    .nextjump-big{
      font-family:"STIX Two Text", serif;
      font-weight:700;
      letter-spacing:.3px;
      line-height:1.1;
      font-size: clamp(24px, 5vw, 56px);
    }
    /* (optional) make the emoji symbol a touch smaller than the text */
    .nextjump-big span[aria-hidden="true"]{ font-size:.9em; }

    
    /* Make the card a positioning context for the skull overlay */
    .card{ position: relative; }
    
    /* Skull overlay */
    .skull{
      position:absolute; inset:0;
      display:none;            /* shown by adding .show */
      align-items:center; justify-content:center;
      font-size: clamp(80px, 12vw, 160px);
      pointer-events:none;     /* overlay is visual only */
    }
    .skull.show{ display:flex; }

    /* Starting point label under the big Next jump */
    .startpoint{
      margin-top: 6px;
      font-weight: 600;
      color: var(--muted);
      font-size: clamp(14px, 2.2vw, 18px);
    }


  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo"><div class="mark">üßÆ</div><h1>Prime‚ÄëFactor Sprint</h1></div>
    <div class="controls card">
      <div>
        <label for="difficulty">Difficulty</label><br>
        <select id="difficulty">
          <option value="unlimited">Easy ‚Äî unlimited</option>
          <option value="10">Medium ‚Äî 10s</option>
          <option value="5">Hard ‚Äî 5s</option>
          <option value="2">Super Hard ‚Äî 2s</option>
        </select>
      </div>
      <div>
        <label for="jumps">Jumps</label><br>
        <select id="jumps">
          <option value="off">Off</option>
          <option value="light">Light</option>
          <option value="normal" selected>Normal</option>
          <option value="chaos">Chaotic</option>
        </select>
      </div>
      <div>
        <label for="startAt">Start at</label><br>
        <select id="startAt">
          <option value="2" selected>2</option>
          <option value="3">3</option>
          <option value="5">5</option>
          <option value="7">7</option>
          <option value="11">11</option>
        </select>
      </div>
      <div style="display:flex; align-items:end; gap:8px;">
        <button id="btnReset" class="muted">Reset</button>
        <button id="btnStart" class="primary">Start ‚ñ∂</button>
      </div>
    </div>
  </header>

  <div class="columns">
    <section class="card" aria-live="polite">
      <div id="timer" class="timer"><div class="bar" style="width:100%"></div></div>

      <div class="question">
        <div class="n" id="qNumber">n = ‚Äî</div>  <!-- stays in DOM but is hidden by CSS -->
        <div class="nextjump-big" id="nextJumpBig">Next jump: +1</div>
        <div id="startPoint" class="startpoint">Starting point: 2</div>
      </div>
      
      <!-- skull overlay (stays inside the same <section class="card">) -->
      <div id="skull" class="skull" aria-hidden="true">‚ò†Ô∏è</div>

      

      <div class="answer">
        <input id="answer" type="text" inputmode="numeric" autocomplete="off" placeholder="Enter digits only: 8 ‚Üí 2√ó2√ó2 ‚Üí 222" />
        <button id="btnSubmit" class="muted">Submit ‚èé</button>
        <button id="btnSkip" class="muted">Skip ‚Ü∑</button>
      </div>

      <div class="feedback" id="feedback">Press Enter to submit ¬∑ Esc to pause ¬∑ X characters (√ó, x) are ignored</div>

      <div class="history">
        <h3>Recent</h3>
        <div class="items" id="history"></div>
      </div>

      <p style="margin:12px 0 0; color:var(--muted)">Rule: for each successive integer, if it‚Äôs <strong>prime</strong>, enter the number. If it‚Äôs <strong>composite</strong>, enter its prime factors concatenated in ascending order. The sequence never drops below 2 and always moves forward. Examples: 11 ‚Üí <span style="font-family:'JetBrains Mono'">11</span>, 12 ‚Üí 2√ó2√ó3 ‚Üí <span style="font-family:'JetBrains Mono'">223</span>.</p>
    </section>

    <aside class="card">
      <div class="status">
        <div class="tile"><div class="k" id="kScore">0</div><div class="v">Score</div></div>
        <div class="tile"><div class="k" id="kStreak">0</div><div class="v">Streak</div></div>
        <div class="tile"><div class="k" id="kLives">‚ù§‚ù§‚ù§</div><div class="v">Lives</div></div>
        <div class="tile"><div class="k" id="kBest">0</div><div class="v">Best</div></div>
      </div>

      <div style="margin-top:16px">
        <h3 style="margin:0 0 8px 0; color:var(--muted)">Jump legend</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
          <div class="jump"><span class="badge">‚ö°</span>Plus 3</div>
          <div class="jump"><span class="badge">‚è©</span>Plus 2</div>
          <div class="jump"><span class="badge">‚ûï</span>Plus 1</div>
          <div class="jump"><span class="badge">‚Ü©Ô∏è</span>Back 1</div>
          <div class="jump"><span class="badge">üåÄ</span>Back 3</div>
        </div>
      </div>

      <div style="margin-top:16px">
        <button id="btnPause" class="muted" style="width:100%">Pause ‚è∏</button>
      </div>
    </aside>
  </div>
</div>

<script>
  // ‚Äî‚Äî‚Äî Primes & factorization ‚Äî‚Äî‚Äî
  function isPrime(n){
    if(n < 2) return false;
    if(n % 2 === 0) return n === 2;
    if(n % 3 === 0) return n === 3;
    let i = 5, w = 2;
    while(i * i <= n){ if(n % i === 0) return false; i += w; w = 6 - w; }
    return true;
  }
  function primeFactors(n){
    const f = [];
    while(n % 2 === 0){ f.push(2); n/=2; }
    let d = 3;
    while(d * d <= n){ while(n % d === 0){ f.push(d); n/=d; } d += 2; }
    if(n > 1) f.push(n);
    return f;
  }
  function expectedInput(n){
    return isPrime(n) ? String(n) : primeFactors(n).map(String).join('');
  }
  function expr(n){
    return isPrime(n) ? String(n) : primeFactors(n).join('√ó');
  }

  // ‚Äî‚Äî‚Äî Elements ‚Äî‚Äî‚Äî
  const el = (id)=>document.getElementById(id);
  const qNumber = el('qNumber');
  const answer = el('answer');
  const feedback = el('feedback');
  const history = el('history');
  const timerWrap = el('timer');
  const bar = timerWrap.querySelector('.bar');
  const kScore = el('kScore');
  const kStreak = el('kStreak');
  const kLives = el('kLives');
  const kBest = el('kBest');

  const btnStart = el('btnStart');
  const btnReset = el('btnReset');
  const btnSubmit = el('btnSubmit');
  const btnSkip = el('btnSkip');
  const btnPause = el('btnPause');

  const ddDiff = el('difficulty');
  const ddJumps = el('jumps');
  const ddStartAt = el('startAt');

  const jumpInfo = el('jumpInfo');
  const jumpSymbol = el('jumpSymbol');
  const jumpText = el('jumpText');

  // ‚Äî‚Äî‚Äî Jumps ‚Äî‚Äî‚Äî
  const JUMPS = {
    '+3': { delta: 3, symbol:'‚ö°', label:'Plus 3' },
    '+2': { delta: 2, symbol:'‚è©', label:'Plus 2' },
    '+1': { delta: 1, symbol:'‚ûï', label:'Plus 1' },
    '-1': { delta:-1, symbol:'‚Ü©Ô∏è', label:'Back 1' },
    '-3': { delta:-3, symbol:'üåÄ', label:'Back 3' },
  };
  function pickNextJump(){
    const mode = ddJumps.value; if(mode === 'off') return null;
    const bag = []; const push=(k,w)=>{for(let i=0;i<w;i++) bag.push(k)};
    if(mode==='light'){ push('+1',5); push('+2',2); push('+3',1); push('-1',2); }
    else if(mode==='normal'){ push('+1',5); push('+2',3); push('+3',1); push('-1',3); }
    else { push('+1',3); push('+2',3); push('+3',2); push('-1',3); push('-3',2); }
    const key = bag[Math.floor(Math.random()*bag.length)];
    return JUMPS[key];
  }
  
  function showJump(next){
    const big = document.getElementById('nextJumpBig');
    if(!big) return;
    if(!next){ big.textContent = ''; return; }
    // include the symbol + label, big and centered
    big.innerHTML = `<span aria-hidden="true">${next.symbol}</span> Next jump: ${next.label}`;
  }



  // ‚Äî‚Äî‚Äî State ‚Äî‚Äî‚Äî
  let state = {
    running:false, paused:false,
    score:0, streak:0, lives:3, best:Number(localStorage.getItem('pfs_best')||0),
    n: Number((el('startAt')?.value)||2),        // current term (displayed)
    target: Number((el('startAt')?.value)||2),   // next term to answer for (after jump)
    lastMax: Number((el('startAt')?.value)||2) - 1,
    nextJump:null,
    timePer:Infinity, timeLeft:Infinity, timerId:null,
  };
  kBest.textContent = String(state.best);

  // ‚Äî‚Äî‚Äî Timing ‚Äî‚Äî‚Äî
  function setDifficulty(val){ state.timePer = (val==='unlimited') ? Infinity : Number(val); }
  function setTimerUI(){
    if(!isFinite(state.timePer)) { timerWrap.classList.add('unlimited'); bar.style.width = '100%'; return; }
    timerWrap.classList.remove('unlimited');
    const pct = Math.max(0, Math.min(1, state.timeLeft / state.timePer));
    bar.style.width = (pct*100).toFixed(1)+'%';
  }
  function startTicking(){
    clearInterval(state.timerId);
    if(!isFinite(state.timePer)) { setTimerUI(); return; }
    state.timerId = setInterval(()=>{
      if(!state.running || state.paused) return;
      state.timeLeft -= 0.1;
      if(state.timeLeft <= 0){ state.timeLeft = 0; setTimerUI(); timesUp(); }
      else setTimerUI();
    }, 100);
  }

  // ‚Äî‚Äî‚Äî Game flow ‚Äî‚Äî‚Äî
  function resetGame(){
    state.running=false; state.paused=false; clearInterval(state.timerId);
    state.lives=3; state.score=0; state.streak=0;
    state.n = Number(ddStartAt.value);
    document.getElementById('startPoint').textContent = `Starting point: ${state.n}`;
    document.getElementById('skull')?.classList.remove('show');
    state.target = state.n;                // will be set in nextRound()
    state.lastMax = state.n - 1;           // ensures strict forward motion
    state.nextJump = pickNextJump();
    setDifficulty(ddDiff.value);
    updateHUD();
    qNumber.textContent = `n = ‚Äî`;
    feedback.textContent = 'Ready! Press Start.'; feedback.className = 'feedback';
    answer.value='';
    showJump(state.nextJump);
    state.timeLeft = state.timePer; setTimerUI();
  }

  function startGame(){
    resetGame();
    state.running=true; state.paused=false;
    nextRound();
  }

  function pauseToggle(){
    if(!state.running) return;
    state.paused = !state.paused;
    btnPause.textContent = state.paused ? 'Resume ‚ñ∂' : 'Pause ‚è∏';
    feedback.textContent = state.paused ? 'Paused' : 'Go!';
  }

  // Display the CURRENT term, but compute the NEXT term as target
  function nextRound(){
    const j = state.nextJump;
    let candidate = j ? (state.n + j.delta) : (state.n + 1);
  
    if (candidate < 2) candidate = 2;
  
    // Soft floor: allow going back, but not more than 5 below the farthest reached
    const softFloor = Math.max(2, state.lastMax - 5);
    if (candidate < softFloor) candidate = softFloor;
  
    state.target = candidate;
  
    qNumber.textContent = `n = ${state.n}`;
    showJump(state.nextJump);
  
    answer.value=''; answer.focus();
    state.timeLeft = state.timePer; setTimerUI(); startTicking();
  }



  function addHistory(n, e, good){
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = `${n} ‚Üí ${e}`;
    if(!good) chip.style.borderColor = 'rgba(239,68,68,.5)';
    history.prepend(chip);
    const kids = Array.from(history.children); for(let i=18;i<kids.length;i++) kids[i].remove();
  }

  function updateHUD(){
    kScore.textContent = String(state.score);
    kStreak.textContent = String(state.streak);
    kLives.textContent = '‚ù§'.repeat(state.lives) + '‚ô°'.repeat(3 - state.lives);
    kBest.textContent = String(state.best);
  }

  function proceed(){
    // Accept the next term and prepare the following round
    state.lastMax = Math.max(state.lastMax, state.target);
    state.n = state.target;                      // ‚úÖ move to the term the student just produced
    state.nextJump = pickNextJump();             // next jump affects the NEXT target
    nextRound();
  }

  function endGame(reason){
    document.getElementById('skull')?.classList.add('show');
    state.running=false; clearInterval(state.timerId);
    feedback.textContent = `Game over ‚Äî ${reason}`; feedback.className='feedback bad';
    qNumber.textContent = 'n = ‚Äî';
    showJump(null);
    updateHUD();
  }

  function miss(reason){
    state.lives -= 1; state.streak = 0; updateHUD();
    if(state.lives <= 0) { endGame(reason); return; }
    feedback.textContent = reason + ' Next!'; feedback.className='feedback bad';
    // Log what they were standing on (current) for clarity
    addHistory(state.n, expr(state.n), false);
    proceed();
  }

  function timesUp(){ if(!state.running) return; miss("Time's up!"); }

  function submit(){
    if(!state.running || state.paused) return;
    const raw = answer.value.trim();
    if(!raw){ answer.classList.add('shake'); setTimeout(()=>answer.classList.remove('shake'), 300); return; }
    const cleaned = raw.replace(/[xX√ó\s]/g, '');
    if(!/^\d+$/.test(cleaned)){
      feedback.textContent = 'Digits only please (√ó, x allowed but ignored).';
      feedback.className = 'feedback bad';
      answer.classList.add('shake'); setTimeout(()=>answer.classList.remove('shake'), 300);
      return;
    }
    const want = expectedInput(state.target);   // ‚úÖ expect input for the NEXT term
    if(cleaned === want){
      state.score += 1; state.streak += 1;
      if(state.score > state.best){
        state.best = state.score; localStorage.setItem('pfs_best', String(state.best));
      }
      feedback.textContent = 'Correct!'; feedback.className='feedback ok'; updateHUD();
      // Log the current term they stood on (optional; keeps chips consistent)
      addHistory(state.n, expr(state.n), true);
      proceed();
    } else {
      feedback.textContent = `Not quite. Expected: ‚Äú${want}‚Äù (i.e., ${expr(state.target)}).`;
      feedback.className='feedback bad';
      answer.classList.add('shake'); setTimeout(()=>answer.classList.remove('shake'), 300);
      miss('Wrong answer.');
    }
  }

  // ‚Äî‚Äî‚Äî Events ‚Äî‚Äî‚Äî
  btnStart.addEventListener('click', startGame);
  btnReset.addEventListener('click', resetGame);
  btnSubmit.addEventListener('click', submit);
  btnSkip.addEventListener('click', ()=>{ if(state.running) proceed(); });
  btnPause.addEventListener('click', pauseToggle);
  ddDiff.addEventListener('change', ()=> setDifficulty(ddDiff.value));

  // Keyboard shortcuts
  answer.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); submit(); }});
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Enter' && document.activeElement!==answer){ submit(); }
    if(e.key==='Escape') pauseToggle();
    if((e.key==='s' || e.key==='S') && !state.paused) { if(state.running) proceed(); }
  });

  // Boot
  resetGame();
</script>


</body>
</html>
