<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unit Analysis Trainer üß†</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=STIX+Two+Text:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <style>
    :root{
      --bg:#fff; --fg:#0b1220; --muted:#5f6b87; --card:#f8fbff;
      --accent:#2e90fa; --accent-2:#00b3a4; --ok:#16a34a; --warn:#eab308; --danger:#ef4444;
      --radius:18px; --shadow:0 8px 30px rgba(17,24,39,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    header{padding:20px;text-align:center}
    h1{font-family:"STIX Two Text",Georgia,serif;margin:0 0 4px}
    .subtle{color:var(--muted);margin:0;font-size:14px}
    .container{max-width:1100px;margin:0 auto;padding:0 20px 40px}
    .card{background:var(--card);border:1px solid rgba(46,144,250,.18);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}

    /* Controls */
    .toolbar{display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px;margin-bottom:10px;align-items:center}
    .pill{border:1px solid rgba(15,23,42,.1);background:#fff;border-radius:999px;padding:6px 12px;font-size:14px;color:var(--muted)}

    /* Question area */
    .question{font-family:"STIX Two Text",Georgia,serif;font-size:20px}
    .timewrap{margin:8px 0;background:#f3f4f6;border-radius:12px;border:1px solid rgba(0,0,0,.08);padding:6px}
    .timebar{height:18px;border-radius:10px;background:linear-gradient(90deg,#22c55e,#facc15,#f97316,#ef4444);width:100%}
    .io-row{display:flex;flex-direction:column;gap:10px;margin-top:14px}
    .btn-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .btn-row button{flex:1;min-width:120px}

    input[type="number"],select,button{
      width:100%;border:1px solid rgba(15,23,42,.16);background:#fff;border-radius:12px;padding:12px 14px;font-size:16px
    }
    button.primary{background:var(--accent);color:#fff;border:none}
    button.secondary{background:#fff;color:var(--accent);border-color:var(--accent)}
    .timer{font-weight:800;color:var(--accent)}
    .meta{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;color:var(--muted);font-size:14px}
    .result{margin-top:12px;padding:10px;border-radius:12px;border:1px solid rgba(15,23,42,.12);background:#fff}

    /* Accuracy bar */
    .progress{height:9px;border-radius:999px;background:#e5e7eb;overflow:hidden;margin-top:8px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--ok),var(--accent-2),var(--accent));transition:width .3s}

    /* Data Box at bottom */
    .data-table{margin-top:22px}
    .data-table h2{font-family:"STIX Two Text",Georgia,serif;margin:0 0 10px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse;font-size:14px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid rgba(15,23,42,.08)}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(15,23,42,.06)}
    th{text-align:left;background:#f9fafb;font-weight:700}
    tr:last-child td{border-bottom:none}

    footer{text-align:center;color:var(--muted);font-size:13px;padding:28px 0 44px}
    @media (max-width:760px){.toolbar{flex-wrap:wrap}.btn-row button{flex:1 1 48%}}
  </style>
</head>
<body>
  <header>
    <h1>Unit Analysis Trainer üß†</h1>
    <p class="subtle">Math with Mr. Merrick</p>
  </header>

  <main class="container">
    <!-- Question Card -->
    <section id="qcard" class="card">
      <div class="toolbar">
        <span class="pill">Difficulty: <span id="diffLabel">‚Äî</span></span>
        <span class="pill">Target: <span id="targetUnit">‚Äî</span></span>
        <span class="pill">Time left: <span class="timer" id="timeLeft">‚Äî</span></span>
        <label class="pill" style="display:flex;gap:8px;align-items:center">
          Timer
          <select id="timerSelect">
            <option value="20">20</option>
            <option value="30" selected>30</option>
            <option value="45">45</option>
            <option value="60">60</option>
          </select>
          s
        </label>
        <button id="newBtn" class="secondary">New Question</button>
      </div>

      <div class="timewrap"><div class="timebar" id="timeBar"></div></div>

      <div class="question" id="questionText">Click <b>New Question</b> to start.</div>

      <div class="io-row">
        <input id="answerInput" type="number" step="any" placeholder="Enter numeric answer"/>
        <button id="checkBtn" class="primary">Check</button>
      </div>
      <div class="btn-row">
        <button id="revealBtn" class="secondary" title="Show exact answer">Reveal</button>
        <button id="skipBtn" class="secondary" title="Skip this question">Skip</button>
      </div>

      <div class="meta">
        <div>Attempts: <b id="attempts">0</b></div>
        <div>Avg % error: <b id="avgErr">‚Äî</b></div>
        <div>Within 5%: <b id="within5">0</b></div>
      </div>

      <div id="result" class="result" style="display:none;"></div>
      <div class="progress" title="Accuracy (this question)"><div class="bar" id="accBar"></div></div>
    </section>

    <!-- Big Data Table (BOTTOM) -->
    <section class="data-table card">
      <h2>Data Box: Useful Equivalences</h2>
      <p class="subtle" style="margin:0 0 10px">Grade 10‚Äì12 focus: SI prefixes, Time, Length, Area, Volume, Mass.</p>
      <div class="grid">
        <div>
          <table>
            <thead><tr><th colspan="3">SI Prefixes</th></tr></thead>
            <tbody>
              <tr><td>milli</td><td>m</td><td>10‚Åª¬≥</td></tr>
              <tr><td>centi</td><td>c</td><td>10‚Åª¬≤</td></tr>
              <tr><td>deci</td><td>d</td><td>10‚Åª¬π</td></tr>
              <tr><td>deka</td><td>da</td><td>10¬π</td></tr>
              <tr><td>hecto</td><td>h</td><td>10¬≤</td></tr>
              <tr><td>kilo</td><td>k</td><td>10¬≥</td></tr>
              <tr><td>mega</td><td>M</td><td>10‚Å∂</td></tr>
              <tr><td>giga</td><td>G</td><td>10‚Åπ</td></tr>
            </tbody>
          </table>

          <table>
            <thead><tr><th colspan="2">Time</th></tr></thead>
            <tbody>
              <tr><td>60 s = 1 min</td><td>60 min = 1 h</td></tr>
              <tr><td>24 h = 1 day</td><td>7 days = 1 week</td></tr>
            </tbody>
          </table>

          <table>
            <thead><tr><th colspan="2">Length</th></tr></thead>
            <tbody>
              <tr><td>1 in = 2.54 cm (exact)</td><td>12 in = 1 ft; 3 ft = 1 yd</td></tr>
              <tr><td>5280 ft = 1 mi</td><td>1 km = 1000 m</td></tr>
            </tbody>
          </table>
        </div>
        <div>
          <table>
            <thead><tr><th colspan="2">Area</th></tr></thead>
            <tbody>
              <tr><td>1 m¬≤ ‚âà 10.764 ft¬≤</td><td>1 cm¬≤ ‚âà 0.1550 in¬≤</td></tr>
              <tr><td>1 yd¬≤ = 9 ft¬≤</td><td>1 acre = 43,560 ft¬≤</td></tr>
            </tbody>
          </table>

          <table>
            <thead><tr><th colspan="2">Volume</th></tr></thead>
            <tbody>
              <tr><td>1 L = 1000 mL = 1000 cm¬≥</td><td>1 m¬≥ = 1000 L</td></tr>
              <tr><td>1 in¬≥ = 16.387 cm¬≥</td><td>1 ft¬≥ = 28.3168 L</td></tr>
              <tr><td>1 US gal ‚âà 3.78541 L</td><td></td></tr>
            </tbody>
          </table>

          <table>
            <thead><tr><th colspan="2">Mass</th></tr></thead>
            <tbody>
              <tr><td>1 kg = 1000 g</td><td>1 lb = 453.59237 g (exact)</td></tr>
              <tr><td>1 oz = 28.3495 g</td><td></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <footer>Built for quick unit conversions. <span class="subtle">Tip: aim &lt; 5% error.</span></footer>

  <script>
    // ---------- KaTeX rendering ONLY inside the question text ----------
    function renderQuestionTeX(){
      if(!window.renderMathInElement) return;
      const el = document.getElementById('questionText');
      window.renderMathInElement(el, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\\\(', right: '\\\\)', display: false }
        ],
      });
    }

    // ---------- TeX formatting helpers ----------
    // Convert "ft^3/min" -> "\mathrm{ft}^{3}/\mathrm{min}"
    function texUnit(unitStr){
      return unitStr.split('/').map(part=>{
        const m = part.match(/^([a-zA-Z¬µ]+)(?:\^(-?\d+))?$/);
        if(!m) return `\\\\mathrm{${part}}`;
        const base = m[1].replace('¬µ','\\\\mu');
        const exp  = m[2] ? `^{${m[2]}}` : '';
        return `\\\\mathrm{${base}}${exp}`;
      }).join('/');
    }
    const texQty = (v,u) => `\\\\(${v}\\\\,${texUnit(u)}\\\\)`;

    // ---------- Utilities ----------
    const rnd=(a,b)=>Math.random()*(b-a)+a;
    const choice=a=>a[Math.floor(Math.random()*a.length)];
    const roundTo=(x,n=4)=>Number.parseFloat(x).toPrecision(n);
    const pct=x=>(x*100).toFixed(2)+'%';

    // ---------- Conversion maps ----------
    const LENGTH = { mm:1e-3, cm:1e-2, m:1, km:1e3, in:0.0254, ft:0.3048, yd:0.9144, mi:1609.344 };
    const TIME   = { s:1, min:60, h:3600, day:86400 };
    const AREA   = { 'cm^2':1e-4, 'm^2':1, 'in^2':0.0254**2, 'ft^2':0.3048**2, 'yd^2':0.9144**2 };
    const VOLUME = { 'cm^3':1e-6, 'mL':1e-6, L:1e-3, 'm^3':1, 'in^3':0.0254**3, 'ft^3':0.3048**3, gal:0.00378541 };
    const MASS   = { mg:1e-6, g:1e-3, kg:1, oz:0.028349523125, lb:0.45359237 };

    const conv = (map, v, from, to) => v * map[from] / map[to];
    const pick2 = (arr)=>{let a=choice(arr),b=choice(arr);while(b===a)b=choice(arr);return [a,b];};

    // ---------- Problem generators ----------
    function genLength(){
      const units=['mm','cm','m','km','in','ft','yd','mi'];
      const [from,to]=pick2(units);
      const v=+rnd(0.2,5000).toFixed(2);
      const ans=conv(LENGTH,v,from,to);
      return { prompt:`Convert ${texQty(v,from)} to \\(${texUnit(to)}\\).`, answer:ans, unit:to, difficulty:'Hard' };
    }
    function genArea(){
      const units=Object.keys(AREA);
      const [from,to]=pick2(units);
      const v=+rnd(0.5,500).toFixed(2);
      const ans=conv(AREA,v,from,to);
      return { prompt:`Convert ${texQty(v,from)} to \\(${texUnit(to)}\\).`, answer:ans, unit:to, difficulty:'Hard' };
    }
    function genVolume(){
      const units=Object.keys(VOLUME);
      const [from,to]=pick2(units);
      const v=+rnd(0.2,20000).toFixed(2);
      const ans=conv(VOLUME,v,from,to);
      return { prompt:`Convert ${texQty(v,from)} to \\(${texUnit(to)}\\).`, answer:ans, unit:to, difficulty:'Hard' };
    }
    function genMass(){
      const units=Object.keys(MASS);
      const [from,to]=pick2(units);
      const v=+rnd(0.2,5000).toFixed(2);
      const ans=conv(MASS,v,from,to);
      return { prompt:`Convert ${texQty(v,from)} to \\(${texUnit(to)}\\).`, answer:ans, unit:to, difficulty:'Medium' };
    }
    function genTime(){
      const units=Object.keys(TIME);
      const [from,to]=pick2(units);
      const v=+rnd(5,20000).toFixed(0);
      const ans=conv(TIME,v,from,to);
      return { prompt:`Convert ${texQty(v,from)} to \\(${texUnit(to)}\\).`, answer:ans, unit:to, difficulty:'Medium' };
    }
    // Speed (Length/Time)
    function genSpeed(){
      const lenFrom=choice(['mm','cm','m','km','in','ft','yd','mi']);
      const lenTo  =choice(['m','km','ft','mi']);
      const tFrom  =choice(['s','min','h']);
      const tTo    =choice(['s','min','h']);
      if(lenFrom===lenTo && tFrom===tTo) return genSpeed();
      const v=+rnd(0.5,500).toFixed(2);
      const ans = v * (LENGTH[lenFrom]/LENGTH[lenTo]) * (TIME[tTo]/TIME[tFrom]);
      const fromUnit = `${lenFrom}/${tFrom}`, toUnit = `${lenTo}/${tTo}`;
      return { prompt:`Convert ${texQty(v,fromUnit)} to \\(${texUnit(toUnit)}\\).`, answer:ans, unit:toUnit, difficulty:'Hard' };
    }
    // Flow (Volume/Time)
    function genFlow(){
      const volFrom=choice(['ft^3','in^3','L','m^3','gal']);
      const volTo  =choice(['L','m^3','ft^3']);
      const tFrom  =choice(['s','min','h']);
      const tTo    =choice(['s','min','h']);
      if(volFrom===volTo && tFrom===tTo) return genFlow();
      const v=+rnd(0.5,500).toFixed(2);
      const ans = v * (VOLUME[volFrom]/VOLUME[volTo]) * (TIME[tTo]/TIME[tFrom]);
      const fromUnit = `${volFrom}/${tFrom}`, toUnit = `${volTo}/${tTo}`;
      return { prompt:`Convert ${texQty(v,fromUnit)} to \\(${texUnit(toUnit)}\\).`, answer:ans, unit:toUnit, difficulty:'Hard' };
    }
    // Surface density (Mass/Area)
    function genSurfDen(){
      const mFrom=choice(['mg','g','kg','oz','lb']);
      const mTo  =choice(['g','kg','oz']);
      const aFrom=choice(['cm^2','m^2','in^2','ft^2','yd^2']);
      const aTo  =choice(['m^2','cm^2','ft^2']);
      const v=+rnd(1,400).toFixed(2);
      const ans = v * (MASS[mFrom]/MASS[mTo]) * (AREA[aTo]/AREA[aFrom]);
      const fromUnit = `${mFrom}/${aFrom}`, toUnit = `${mTo}/${aTo}`;
      return { prompt:`Convert ${texQty(v,fromUnit)} to \\(${texUnit(toUnit)}\\).`, answer:ans, unit:toUnit, difficulty:'Hard' };
    }

    const BANK=[genLength,genArea,genVolume,genMass,genTime,genSpeed,genFlow,genSurfDen];

    // ---------- Timer & stats ----------
    let timerId=null, timeRemaining=30, timeTotal=30;
    const timeLeftEl=document.getElementById('timeLeft');
    const timerSelect=document.getElementById('timerSelect');
    const timeBar=document.getElementById('timeBar');
    const stats={attempts:0,sumAbsRelErr:0,within5:0};

    function startTimer(){
      clearInterval(timerId);
      timeRemaining = timeTotal = parseInt(timerSelect.value,10);
      updateTimeUI();
      timerId = setInterval(()=>{
        timeRemaining--;
        updateTimeUI();
        if(timeRemaining<=0){ clearInterval(timerId); revealAnswer(true); }
      },1000);
    }
    function updateTimeUI(){
      const p = Math.max(0,timeRemaining)/timeTotal;
      timeLeftEl.textContent = Math.max(0,timeRemaining)+'s'; // plain 's'
      timeBar.style.width = (p*100)+'%';
    }

    // ---------- UI actions ----------
    let current=null;
    function newQuestion(){
      current = choice(BANK)();
      const q = document.getElementById('questionText');
      q.innerHTML = current.prompt;          // contains \( ... \)
      renderQuestionTeX();                   // render math cleanly
      document.getElementById('targetUnit').textContent = current.unit;
      document.getElementById('diffLabel').textContent = current.difficulty;
      document.getElementById('result').style.display='none';
      document.getElementById('accBar').style.width='0%';
      document.getElementById('answerInput').value='';
      startTimer();
    }

    function classifyAccuracy(err){
      if(!isFinite(err)) return {label:'‚Äî',color:'var(--muted)',width:'0%'};
      if(err<0.005) return {label:'Exact (‚â§0.5%)',color:'var(--ok)',width:'100%'};
      if(err<0.02)  return {label:'Great (‚â§2%)',color:'var(--ok)',width:'90%'};
      if(err<0.05)  return {label:'Good (‚â§5%)',color:'var(--accent-2)',width:'75%'};
      if(err<0.10)  return {label:'Close (‚â§10%)',color:'var(--warn)',width:'55%'};
      if(err<0.20)  return {label:'Rough (‚â§20%)',color:'var(--warn)',width:'35%'};
      return {label:'Off (>20%)',color:'var(--danger)',width:'18%'};
    }

    function showResult(userVal,timedOut=false){
      const res=document.getElementById('result');
      const accBar=document.getElementById('accBar');
      const truth=+current.answer;
      const relErr=Math.abs((userVal-truth)/truth);
      const acc=classifyAccuracy(relErr);

      res.style.display='block';
      res.innerHTML = `
        <div><b>${timedOut?"Time's up! ":''}Your ${current.unit}:</b> ${isNaN(userVal)?'‚Äî':userVal}</div>
        <div><b>Exact:</b> ${roundTo(truth,5)} ${current.unit}</div>
        <div><b>Error:</b> ${pct(relErr)}</div>
        <div><b>Rating:</b> <span style="color:${acc.color};font-weight:700;">${acc.label}</span></div>
      `;
      accBar.style.width=acc.width;

      stats.attempts++;
      stats.sumAbsRelErr += isFinite(relErr)? relErr : 0;
      if(relErr<=0.05) stats.within5++;
      document.getElementById('attempts').textContent = stats.attempts;
      document.getElementById('within5').textContent  = stats.within5;
      document.getElementById('avgErr').textContent   = stats.attempts ? pct(stats.sumAbsRelErr/stats.attempts) : '‚Äî';
    }

    function checkAnswer(){
      if(!current) return;
      const v = +document.getElementById('answerInput').value;
      if(Number.isNaN(v)) return;
      clearInterval(timerId);
      showResult(v);
    }
    function revealAnswer(timedOut=false){
      if(!current) return;
      clearInterval(timerId);
      showResult(Number.NaN, timedOut);
    }

    // Wire up
    document.getElementById('newBtn').addEventListener('click', newQuestion);
    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('revealBtn').addEventListener('click', ()=>revealAnswer(false));
    document.getElementById('skipBtn').addEventListener('click', newQuestion);
    document.getElementById('answerInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkAnswer(); });

    // Initial timer label
    timeLeftEl.textContent = document.getElementById('timerSelect').value + 's';
  </script>
</body>
</html>
