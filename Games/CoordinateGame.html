<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coordinate Dash</title>
  <style>
    :root {
      --bg: #f9fafb;
      --panel: #ffffff;
      --muted: #4b5563;
      --text: #1f2937;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --card: #f3f4f6;
      --radius: 16px;
      --button-bg: #3b82f6;
      --button-bg-hover: #2563eb;
      --button-text: #ffffff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial;
      background: var(--bg);
      color: var(--text);
    }
    .container { max-width: 900px; margin: 32px auto; padding: 0 16px; }

    header {
      background: var(--panel);
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    header h1 { margin: 0 0 4px 0; font-size: 26px; }
    header p { margin: 0; color: var(--muted); }

    .heading-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .control label { display:block; font-size: 12px; margin-bottom: 4px; color: var(--muted); }
    .control input, .control select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #fff;
      color: var(--text);
    }
    .control button, .primary {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      background: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    .control button:hover, .primary:hover {
      background: var(--button-bg-hover);
    }

    .timer { border: 1px solid #000; padding: 6px 10px; border-radius: 6px; text-align: center; font-variant-numeric: tabular-nums; }
    .timer-controls { display:flex; align-items:center; gap:8px; justify-content:flex-end; }

    .panel { background: var(--panel); border: 1px solid #e5e7eb; border-radius: var(--radius); padding: 16px; margin-top: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .panel h2 { margin-top: 0; }
    .list { display: grid; gap: 12px; }
    .card { background: var(--card); border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px; }
    .step-head { display: flex; justify-content: space-between; align-items: center; }
    .answer { margin-top: 8px; color: var(--button-bg); font-weight: 600; display:none; }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Coordinate Dash</h1>
    <p class="muted">Math with Mr. Merrick</p>
    <div class="heading-controls">
      <div class="control">
        <label for="stepsInput">Number of steps</label>
        <select id="stepsInput"><option>4</option><option selected>6</option><option>8</option><option>10</option></select>
      </div>
      <div class="control">
        <label for="boundInput">Coordinate bound</label>
        <select id="boundInput"><option>8</option><option selected>10</option><option>12</option><option>15</option></select>
      </div>
      <div class="control">
        <label for="seedInput">Seed</label>
        <input id="seedInput" type="text" placeholder="e.g. 12345 or any text" />
      </div>
      <div class="control">
        <label>&nbsp;</label>
        <button class="primary" id="generateBtn">Generate</button>
      </div>
    </div>
    <div class="timer-controls" style="margin-top:12px;">
      <span class="timer" id="timer">00:00</span>
      <button class="primary" id="toggleTimerBtn">Pause</button>
      <button class="primary" id="resetBtn">Reset</button>
    </div>
  </header>

  <section class="panel">
    <h2>Transformations</h2>
    <div id="answers" class="list"></div>
  </section>

  <!-- New Button Section -->
  <div style="margin-top: 24px; text-align: center;">
    <a href="https://merrickmath.github.io/Coordinatetransform.html" target="_blank" class="primary" style="display:inline-block; padding: 12px 20px; border-radius: 8px; text-decoration: none;">
      Coordinate Transformer
    </a>
  </div>
</div>

<script>
// ===== Deterministic RNG (mulberry32) + string hashing =====
function mulberry32(a) {
  return function() {
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function hashStringToSeed(str) {
  let h = 0x811c9dc5; // FNV-1a
  for (let i = 0; i < str.length; i++) { h ^= str.charCodeAt(i); h = Math.imul(h, 0x01000193); }
  return h >>> 0;
}

let rng = mulberry32(123456789);
function reseed(seedVal) {
  let seed;
  if (typeof seedVal === 'number' && Number.isFinite(seedVal)) seed = seedVal >>> 0;
  else if (typeof seedVal === 'string' && seedVal.trim().length) seed = hashStringToSeed(seedVal.trim());
  else seed = (Date.now() ^ Math.floor(Math.random() * 1e9)) >>> 0;
  rng = mulberry32(seed);
  return seed;
}
function rand() { return rng(); }
function randint(min, max) { return Math.floor(rand() * (max - min + 1)) + min; }
function choice(arr) { return arr[Math.floor(rand() * arr.length)]; }

// ===== Transformations =====
function random_translation() {
  const direction = choice(["up", "down", "left", "right"]);
  const magnitude = randint(1, 5);
  const desc = `Translate ${magnitude} unit${magnitude===1?'':'s'} ${direction}`;
  function fn(x, y) {
    if (direction === 'up') return [x, y + magnitude];
    if (direction === 'down') return [x, y - magnitude];
    if (direction === 'right') return [x + magnitude, y];
    return [x - magnitude, y];
  }
  return [desc, fn];
}
function random_reflection() {
  const axis = choice(["x-axis", "y-axis", "line"]);
  if (axis === 'x-axis') return ["Reflect over x-axis", (x, y) => [x, -y]];
  if (axis === 'y-axis') return ["Reflect over y-axis", (x, y) => [-x, y]];
  const lineType = choice(["x=", "y="]);
  const value = randint(-3, 3);
  if (lineType === 'x=') return [`Reflect over the line x = ${value}`, (x, y) => [2*value - x, y]];
  return [`Reflect over the line y = ${value}`, (x, y) => [x, 2*value - y]];
}
function random_rotation() {
  const angle = choice([90, -90]);
  const pivot = [randint(-5, 5), randint(-5, 5)];
  const arrow = angle === 90 ? '↺' : '↻';
  const desc = `Rotate ${Math.abs(angle)}° ${arrow} about the point (${pivot[0]}, ${pivot[1]})`;
  function fn(x, y) {
    const [x0, y0] = pivot; const dx = x - x0, dy = y - y0;
    if (angle === 90) return [x0 - dy, y0 + dx];
    return [x0 + dy, y0 - dx];
  }
  return [desc, fn];
}
function generate_random_transformation() { return choice([random_translation, random_reflection, random_rotation])(); }

// ===== UI refs =====
const answersEl = document.getElementById('answers');
const seedInput = document.getElementById('seedInput');
const stepsInput = document.getElementById('stepsInput');
const boundInput = document.getElementById('boundInput');
const generateBtn = document.getElementById('generateBtn');

// Timer controls
const timerEl = document.getElementById('timer');
const toggleTimerBtn = document.getElementById('toggleTimerBtn');
const resetBtn = document.getElementById('resetBtn');

let timerHandle = null; let elapsedSec = 0;
function fmtTime(sec) { const m = Math.floor(sec / 60); const s = sec % 60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
function timerStart() { if (timerHandle) return; timerHandle = setInterval(() => { elapsedSec++; timerEl.textContent = fmtTime(elapsedSec); }, 1000); }
function timerStop() { if (timerHandle) { clearInterval(timerHandle); timerHandle = null; } }
function timerReset() { timerStop(); elapsedSec = 0; timerEl.textContent = fmtTime(elapsedSec); }
toggleTimerBtn?.addEventListener('click', () => {
  if (timerHandle) { timerStop(); toggleTimerBtn.textContent = 'Start'; }
  else { timerStart(); toggleTimerBtn.textContent = 'Pause'; }
});
resetBtn?.addEventListener('click', () => { timerReset(); if (toggleTimerBtn) toggleTimerBtn.textContent = 'Start'; });

function renderAnswers(startPt, steps, seedUsed) {
  answersEl.innerHTML = '';
  const startCard = document.createElement('div');
  startCard.className = 'card';
  startCard.innerHTML = `<div class="step-head"><span class="step-desc">Seed: ${seedUsed}</span><span class="mono">Start: (${startPt[0]}, ${startPt[1]})</span></div>`;
  answersEl.appendChild(startCard);

  steps.forEach((step, idx) => {
    const [desc, coord] = step;
    const card = document.createElement('div');
    card.className = 'card';
    const ansId = `ans-${idx}`;
    card.innerHTML = `
      <div class="step-head">
        <div class="step-desc">${idx+1} · ${desc}</div>
        <div class="step-actions">
          <button class="primary" data-target="${ansId}">Show result</button>
        </div>
      </div>
      <div class="answer mono" id="${ansId}">(${coord[0]}, ${coord[1]})</div>
    `;
    answersEl.appendChild(card);
  });

  answersEl.querySelectorAll('button[data-target]').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-target');
      const el = document.getElementById(id);
      const vis = el.style.display === 'block';
      el.style.display = vis ? 'none' : 'block';
      btn.textContent = vis ? 'Show result' : 'Hide result';
    });
  });
}

function generate() {
  const stepsN = parseInt(stepsInput?.value, 10) || 6;
  const BOUND = parseInt(boundInput?.value, 10) || 10;
  const seedText = (seedInput?.value || '').trim();
  const seedUsed = reseed(seedText.length ? seedText : undefined);

  const start = [ randint(-BOUND + 1, BOUND - 1), randint(-BOUND + 1, BOUND - 1) ];
  const tforms = Array.from({ length: stepsN }, () => generate_random_transformation());

  let [x, y] = start; const steps = [];
  for (const [desc, fn] of tforms) { [x, y] = fn(x, y); steps.push([desc, [x, y]]); }

  renderAnswers(start, steps, seedUsed);

  timerReset();
  timerStart();

  const params = new URLSearchParams({ seed: seedText || String(seedUsed), steps: String(stepsN), bound: String(BOUND) });
  try { history.replaceState(null, '', `${location.pathname}#${params.toString()}`); } catch {}
}

generateBtn?.addEventListener('click', generate);

function initFromHash() {
  if (!location.hash) return false;
  const q = new URLSearchParams(location.hash.slice(1));
  const seed = q.get('seed'); if (seed && seedInput) seedInput.value = seed;
  const steps = q.get('steps'); if (steps && stepsInput) stepsInput.value = steps;
  const bound = q.get('bound'); if (bound && boundInput) boundInput.value = bound;
  return true;
}

initFromHash();
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', generate);
} else {
  generate();
}
</script>
</body>
</html>
